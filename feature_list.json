[
  {
    "_metadata": true,
    "description": "Active feature tasks for Editorial Assistant v3.5+",
    "archive_reference": "planning/archive/feature_list_v3.0_completed.json",
    "last_updated": "2026-01-15"
  },
  {
    "id": "backlog.1",
    "name": "Assess project rename to cardigan-editorial-assistant",
    "sprint": "backlog",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "low",
    "description": "Audit what needs to change to rename project from 'ai-editorial-assistant-v3' to 'cardigan-editorial-assistant'. Less clunky, more distinctive branding. Assessment should identify: git repo rename, package.json changes, Python package names, hardcoded references in code/docs, MCP server registration name, deployment configs, any external integrations referencing the old name.",
    "files": [
      "package.json",
      "web/package.json",
      "mcp_server/server.py",
      "docs/",
      "CLAUDE.md"
    ],
    "exit_criteria": [
      "Complete inventory of files/configs requiring changes",
      "Risk assessment for breaking changes",
      "Recommended migration steps documented",
      "Decision on whether to do in-place rename or fresh repo"
    ],
    "source": "User request 2026-01-12"
  },
  {
    "id": "backlog.2",
    "name": "Content Calendar bulk scheduling interface",
    "sprint": "backlog",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "medium",
    "description": "Design and implement interface for bulk Content Calendar task creation. User workflow: paste list of videos with target days (e.g., 'Midshow 1211 - Cia Siab Inc. - Thursday') \u2192 system looks up Media IDs, determines required platforms, checks editing status \u2192 creates Content Calendar entries in 'All Tasks' table linked to SST records with publish date/time and due date (2 weeks prior). Reference existing automation: /Users/mriechers/Developer/the-lodge/workflow-automation/airtable-pbswi-automations/scripts/content-calendar-automation.js. SAFETY ARCHITECTURE: Controlled Airtable write access with strict guardrails - (1) scope-limited to Content Calendar/All Tasks table ONLY, (2) append-only operations (CREATE, never UPDATE/DELETE), (3) API-level or code-level enforcement of these constraints, (4) explicit user confirmation before any write.",
    "files": [
      "web/src/pages/Schedule.tsx",
      "api/routers/schedule.py",
      "api/services/airtable.py"
    ],
    "exit_criteria": [
      "Research: Document All Tasks table schema and required fields",
      "Research: Map platform determination logic from SST fields",
      "Research: Understand content-calendar-automation.js patterns",
      "Design: UX mockup for bulk input \u2192 preview \u2192 confirm flow",
      "Design: Decide on Airtable write policy (agent writes vs human confirms)",
      "Implementation: Working bulk scheduling with editing status visibility"
    ],
    "source": "User request 2026-01-12",
    "research_refs": [
      "/Users/mriechers/Developer/the-lodge/workflow-automation/airtable-pbswi-automations/scripts/content-calendar-automation.js",
      "docs/AIRTABLE_CHEATSHEET.md"
    ]
  },
  {
    "id": "backlog.3",
    "name": "Cloudflare Tunnel for remote access",
    "sprint": "backlog",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "medium",
    "description": "Configure Cloudflare Tunnel to expose API (port 8000) and web dashboard (port 3000) for secure remote access. Use Cloudflare Access for email-based authentication without requiring application-level auth changes. Enables remote MCP access from Claude Desktop on different machines. Bridge item between V3.5 feature work and V4.0 deployment - allows remote testing without full production hardening.",
    "files": [
      "scripts/start.sh",
      "docs/REMOTE_ACCESS.md"
    ],
    "exit_criteria": [
      "cloudflared installed and tunnel created",
      "API and web dashboard accessible via tunnel URL",
      "Cloudflare Access configured with email allowlist",
      "Documentation for setup and usage",
      "Optional: MCP server exposed for remote Claude Desktop"
    ],
    "source": "User request 2026-01-14",
    "notes": "Tactical infrastructure task, not a product feature. Can be done independently of sprint work. See planning/DESIGN_4.0.md Part 6 for detailed setup instructions."
  },
  {
    "id": "11.1.1",
    "name": "Database migration: available_files table",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "critical",
    "description": "Create Alembic migration for the available_files table to track remote SRT files discovered on the ingest server. Includes columns for remote_url (unique), filename, directory_path, media_id, file_size_bytes, remote_modified_at, first_seen_at, last_seen_at, status (new/queued/ignored/missing), status_changed_at, and job_id foreign key. Add indexes on status, media_id, and first_seen_at.",
    "files": [
      "alembic/versions/XXX_add_available_files.py"
    ],
    "exit_criteria": [
      "Migration creates available_files table with all specified columns",
      "Indexes created on status, media_id, first_seen_at",
      "Foreign key to jobs table on job_id",
      "Migration runs without error (up and down)"
    ],
    "dependencies": [],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.2",
    "name": "Pydantic models for ingest types",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "critical",
    "description": "Create Pydantic models for ingest-related data types: RemoteFile (file discovered on server), AvailableFile (database record), ScanResult (scan operation result), IngestConfig (server configuration). These models support the API endpoints and scanner service.",
    "files": [
      "api/models/ingest.py"
    ],
    "exit_criteria": [
      "RemoteFile model with url, filename, size, modified_at",
      "AvailableFile model matching database schema",
      "ScanResult with new_files_found, total_files, duration_ms",
      "IngestConfig with base_url, poll_interval, file_extensions, auth settings"
    ],
    "dependencies": [],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.3",
    "name": "Ingest configuration schema and defaults",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "critical",
    "description": "Add ingest_server configuration section to config/llm-config.json with sensible defaults. Include enabled flag, base_url, directories to watch, poll_interval_minutes, file_extensions, auth settings, and timeout. Load and validate configuration in the application.",
    "files": [
      "config/llm-config.json",
      "api/services/config.py"
    ],
    "exit_criteria": [
      "ingest_server section added to llm-config.json",
      "Config loaded and validated on app startup",
      "Environment variable overrides work (INGEST_SERVER_URL, etc.)",
      "Graceful handling when config section missing"
    ],
    "dependencies": [],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.4",
    "name": "IngestScanner service: directory listing parser",
    "sprint": "11.1",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "critical",
    "description": "Create IngestScanner service with HTTP client and HTML parser. Implements parse_directory_listing() to extract file info from Apache/nginx autoindex HTML. Handles various autoindex formats, extracts filenames, sizes, and dates. Uses BeautifulSoup for HTML parsing. Includes robust error handling for network failures and malformed HTML.",
    "files": [
      "api/services/ingest_scanner.py"
    ],
    "exit_criteria": [
      "parse_directory_listing() extracts files from Apache autoindex HTML",
      "Handles nginx autoindex format as well",
      "Extracts filename, optional size, optional date",
      "Filters by configured file extensions (.srt, .txt)",
      "Graceful handling of malformed HTML"
    ],
    "dependencies": [
      "11.1.2",
      "11.1.3"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.5",
    "name": "IngestScanner service: scan and diff logic",
    "sprint": "11.1",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "critical",
    "description": "Add scan_remote_server() method to IngestScanner that fetches directory listings, compares against database records, and updates available_files table. New files get status='new', missing files get status='missing', existing files update last_seen_at. Uses extract_media_id() utility for Media ID extraction from filenames.",
    "files": [
      "api/services/ingest_scanner.py",
      "api/services/database.py"
    ],
    "exit_criteria": [
      "scan_remote_server() fetches and parses remote directories",
      "New files inserted with status='new'",
      "Existing files update last_seen_at",
      "Missing files marked status='missing'",
      "Media ID extracted and stored"
    ],
    "dependencies": [
      "11.1.1",
      "11.1.4"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.6",
    "name": "IngestScanner service: file download",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "high",
    "description": "Add download_file() method to IngestScanner that downloads a remote file to the transcripts/ folder. Includes URL validation (only allow configured base URL), file size limits (100MB max), proper error handling, and returns the local file path on success.",
    "files": [
      "api/services/ingest_scanner.py"
    ],
    "exit_criteria": [
      "download_file() fetches remote file to transcripts/",
      "URL validation prevents downloads from non-allowed domains",
      "File size limit enforced (configurable, default 100MB)",
      "Returns Path to downloaded file",
      "Proper cleanup on failure"
    ],
    "dependencies": [
      "11.1.4"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.7",
    "name": "Ingest API router: read endpoints",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "critical",
    "description": "Create ingest router with read-only endpoints: GET /api/ingest/available (list new files with filtering), GET /api/ingest/status (scanner status and file counts). Follows existing router patterns from jobs.py and queue.py.",
    "files": [
      "api/routers/ingest.py",
      "api/main.py"
    ],
    "exit_criteria": [
      "GET /available returns files filtered by status",
      "GET /available supports limit and include_ignored params",
      "GET /status returns scanner config, last_scan_at, file counts",
      "Router registered in main.py",
      "Proper error handling and validation"
    ],
    "dependencies": [
      "11.1.1",
      "11.1.2"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.8",
    "name": "Ingest API router: action endpoints",
    "sprint": "11.1",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "critical",
    "description": "Add action endpoints to ingest router: POST /api/ingest/queue/{file_id} (download and queue single file), POST /api/ingest/queue/bulk (queue multiple files), POST /api/ingest/ignore/{file_id}, POST /api/ingest/unignore/{file_id}, POST /api/ingest/scan (trigger manual scan). Queue endpoints integrate with existing job creation logic including SST auto-linking.",
    "files": [
      "api/routers/ingest.py"
    ],
    "exit_criteria": [
      "POST /queue/{file_id} downloads file and creates job",
      "POST /queue/bulk handles multiple files atomically",
      "POST /ignore and /unignore update file status",
      "POST /scan triggers immediate scan and returns results",
      "SST auto-linking works for queued files",
      "Proper error responses for not found, already queued, etc."
    ],
    "dependencies": [
      "11.1.5",
      "11.1.6",
      "11.1.7"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.9",
    "name": "Background polling task for ingest scanner",
    "sprint": "11.1",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "high",
    "description": "Add background polling loop that runs the ingest scanner at configured intervals. Integrates with FastAPI startup/shutdown events. Logs scan results, handles errors gracefully without crashing the polling loop. Respects enabled/disabled config flag.",
    "files": [
      "api/main.py",
      "api/services/ingest_scanner.py"
    ],
    "exit_criteria": [
      "Polling task starts on app startup (if enabled)",
      "Runs at configured poll_interval_minutes",
      "Errors logged but don't crash loop",
      "Clean shutdown on app termination",
      "Can be disabled via config"
    ],
    "dependencies": [
      "11.1.5"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.10",
    "name": "IngestPanel React component",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "high",
    "description": "Create IngestPanel React component for the dashboard. Shows list of new files from ingest server with filename, media_id, first_seen time. Includes 'Add to Queue' and 'Ignore' buttons per file, 'Queue All' bulk action, 'Scan Now' button, and last scan timestamp. Uses existing UI patterns (cards, buttons, skeleton loaders).",
    "files": [
      "web/src/components/IngestPanel.tsx"
    ],
    "exit_criteria": [
      "Displays list of available files with metadata",
      "Add to Queue button queues individual file",
      "Ignore button hides file from list",
      "Queue All button with confirmation",
      "Scan Now button triggers manual scan",
      "Shows last scan time",
      "Loading and empty states handled"
    ],
    "dependencies": [
      "11.1.7",
      "11.1.8"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.11",
    "name": "Integrate IngestPanel into dashboard",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "high",
    "description": "Add IngestPanel to the Home page or create dedicated Ingest page. Add navigation link if separate page. Consider WebSocket integration for real-time updates when new files discovered. Add badge/notification indicator for new file count in navigation.",
    "files": [
      "web/src/pages/Home.tsx",
      "web/src/components/Layout.tsx"
    ],
    "exit_criteria": [
      "IngestPanel visible on Home page (or dedicated page)",
      "Navigation updated if separate page",
      "Badge shows count of new files in nav",
      "Panel refreshes on WebSocket events (if implemented)"
    ],
    "dependencies": [
      "11.1.10"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.12",
    "name": "Ingest scanner unit and integration tests",
    "sprint": "11.1",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "medium",
    "description": "Create comprehensive tests for ingest functionality. Unit tests: HTML parsing for various Apache/nginx formats, media ID extraction, file status transitions. Integration tests: API endpoints, queue workflow, scan operation. Mock HTTP responses for remote server.",
    "files": [
      "tests/api/test_ingest_scanner.py",
      "tests/api/test_ingest_router.py"
    ],
    "exit_criteria": [
      "test_ingest_scanner.py covers HTML parsing variants",
      "test_ingest_scanner.py covers media ID extraction edge cases",
      "test_ingest_router.py covers all API endpoints",
      "Mocking used for HTTP and database",
      "Tests pass in CI"
    ],
    "dependencies": [
      "11.1.8"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.13",
    "name": "Database migration: screengrab_attachments audit table",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "high",
    "description": "Create Alembic migration for screengrab_attachments audit log table. Tracks all Airtable attachment operations for accountability. Columns: available_file_id (FK), sst_record_id, media_id, filename, remote_url, attached_at, attachments_before, attachments_after, success, error_message. Critical for audit trail of the controlled Airtable write exception.",
    "files": [
      "alembic/versions/XXX_add_screengrab_attachments.py"
    ],
    "exit_criteria": [
      "Migration creates screengrab_attachments table with all columns",
      "Foreign key to available_files table",
      "Migration runs without error (up and down)",
      "Indexes on sst_record_id and attached_at for query performance"
    ],
    "dependencies": [
      "11.1.1"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md - Screengrab Workflow"
  },
  {
    "id": "11.1.14",
    "name": "Extend available_files for screengrab support",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "high",
    "description": "Update 11.1.1 migration to include file_type column ('transcript' or 'screengrab'), airtable_record_id, and attached_at columns. Add index on file_type. Update Pydantic models to include new fields and status values ('attached', 'no_match').",
    "files": [
      "alembic/versions/XXX_add_available_files.py",
      "api/models/ingest.py"
    ],
    "exit_criteria": [
      "file_type column distinguishes transcripts from screengrabs",
      "airtable_record_id stores SST record after attachment",
      "attached_at timestamp for screengrab attachments",
      "Status enum includes 'attached' and 'no_match' values",
      "Index on file_type for efficient filtering"
    ],
    "dependencies": [],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md - Database Schema"
  },
  {
    "id": "11.1.15",
    "name": "Update IngestScanner for JPG file detection",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "high",
    "description": "Extend IngestScanner to detect and track .jpg/.jpeg/.png files in addition to .srt/.txt. Route files by type: transcripts go to existing workflow, screengrabs go to ScreengrabAttacher. Update config to include screengrab_extensions list.",
    "files": [
      "api/services/ingest_scanner.py",
      "config/llm-config.json"
    ],
    "exit_criteria": [
      "Scanner detects .jpg, .jpeg, .png files",
      "Files tagged with file_type='screengrab' in database",
      "Configuration includes screengrab_extensions array",
      "Media ID extraction works for screengrab filenames",
      "Scan results separate transcript and screengrab counts"
    ],
    "dependencies": [
      "11.1.4",
      "11.1.14"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md - Architecture Components"
  },
  {
    "id": "11.1.16",
    "name": "ScreengrabAttacher service: core logic",
    "sprint": "11.1",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "critical",
    "description": "Create ScreengrabAttacher service for Airtable SST attachment. SAFETY CRITICAL: Implements additive-only writes - NEVER removes or replaces existing attachments. Core methods: attach_screengrab(file_id) looks up SST by Media ID, fetches existing Screen Grab attachments, appends new one, updates record. Includes duplicate detection by filename. All operations logged to audit table.",
    "files": [
      "api/services/screengrab_attacher.py"
    ],
    "exit_criteria": [
      "attach_screengrab() appends to existing attachments (NEVER replaces)",
      "Fetches current attachments before update to preserve them",
      "Detects duplicate filenames and skips",
      "Logs all operations to screengrab_attachments table",
      "Sets status='no_match' when Media ID not found in SST",
      "Uses SST_TABLE_ID and SCREEN_GRAB_FIELD_ID constants"
    ],
    "dependencies": [
      "11.1.13",
      "11.1.14"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md - Service: ScreengrabAttacher"
  },
  {
    "id": "11.1.17",
    "name": "ScreengrabAttacher service: batch operations",
    "sprint": "11.1",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "high",
    "description": "Add batch methods to ScreengrabAttacher: attach_all_pending() processes all 'new' screengrabs with matching SST records. Returns BatchAttachResult with attached count, skipped count (no_match), and any errors. Implements rate limiting to avoid Airtable API throttling.",
    "files": [
      "api/services/screengrab_attacher.py"
    ],
    "exit_criteria": [
      "attach_all_pending() processes all new screengrabs",
      "Returns detailed results (attached, skipped, errors)",
      "Rate limiting prevents API throttling (5 req/sec default)",
      "Individual failures don't stop batch processing",
      "Progress can be tracked via return value"
    ],
    "dependencies": [
      "11.1.16"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md - Service: ScreengrabAttacher"
  },
  {
    "id": "11.1.18",
    "name": "Screengrab API endpoints",
    "sprint": "11.1",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "critical",
    "description": "Add screengrab-specific endpoints to ingest router: GET /api/ingest/screengrabs (list with SST match preview), POST /api/ingest/screengrabs/{file_id}/attach (attach single), POST /api/ingest/screengrabs/attach-all (batch attach), POST /api/ingest/screengrabs/{file_id}/retry-match (retry SST lookup). Response includes attachment counts before/after.",
    "files": [
      "api/routers/ingest.py"
    ],
    "exit_criteria": [
      "GET /screengrabs returns files with SST match info",
      "POST /attach performs single attachment with audit logging",
      "POST /attach-all processes all pending with summary response",
      "POST /retry-match allows re-lookup after SST record creation",
      "Response includes attachment_count_before and attachment_count_after",
      "Proper error handling for no_match, already_attached, API failures"
    ],
    "dependencies": [
      "11.1.16",
      "11.1.17",
      "11.1.8"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md - Screengrab-Specific Endpoints"
  },
  {
    "id": "11.1.19",
    "name": "ScreengrabPanel React component",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "high",
    "description": "Create ScreengrabPanel component for dashboard showing screengrab attachment status. Displays: pending screengrabs with SST match preview (title, existing grab count), 'Attach' button per file, 'Attach All' bulk action, 'no_match' items with explanation. Shows attachment audit trail (recent attachments with before/after counts).",
    "files": [
      "web/src/components/ScreengrabPanel.tsx"
    ],
    "exit_criteria": [
      "Lists pending screengrabs with Media ID and SST match info",
      "Shows existing screengrab count on SST record",
      "Attach button with confirmation (shows what will happen)",
      "Attach All with preview of how many will be processed",
      "No-match items displayed separately with explanation",
      "Recent attachments audit log section"
    ],
    "dependencies": [
      "11.1.18"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md - Web Dashboard Component"
  },
  {
    "id": "11.1.20",
    "name": "Integrate ScreengrabPanel into dashboard",
    "sprint": "11.1",
    "status": "pending",
    "agent": "the-drone",
    "priority": "high",
    "description": "Add ScreengrabPanel to dashboard, either as tab in IngestPanel or separate section. Update /api/ingest/status to include screengrab counts (new, attached, no_match). Consider auto_attach_screengrabs config option for hands-free operation.",
    "files": [
      "web/src/pages/Home.tsx",
      "web/src/components/IngestPanel.tsx"
    ],
    "exit_criteria": [
      "ScreengrabPanel visible on dashboard",
      "Status endpoint includes screengrab metrics",
      "Badge shows count of pending screengrabs",
      "Optional: auto-attach toggle in settings (if enabled in config)"
    ],
    "dependencies": [
      "11.1.19",
      "11.1.11"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md"
  },
  {
    "id": "11.1.21",
    "name": "Screengrab unit and integration tests",
    "sprint": "11.1",
    "status": "pending",
    "agent": "orchestrator",
    "priority": "high",
    "description": "Comprehensive tests for screengrab workflow. CRITICAL: Test that existing attachments are NEVER removed - this is the key safety constraint. Unit tests: attachment append logic, duplicate detection, no-match handling, audit log creation. Integration tests: API endpoints, batch operations. Mock Airtable API responses.",
    "files": [
      "tests/api/test_screengrab_attacher.py",
      "tests/api/test_screengrab_api.py"
    ],
    "exit_criteria": [
      "Test verifies existing attachments preserved (CRITICAL)",
      "Test verifies duplicate filename detection",
      "Test verifies no_match status when SST not found",
      "Test verifies audit log entries created",
      "API endpoint tests cover all responses",
      "Batch operation tests verify partial failure handling",
      "Airtable API mocked for all tests"
    ],
    "dependencies": [
      "11.1.18"
    ],
    "source": "docs/FEATURE_REMOTE_INGEST_WATCHER.md - Testing Requirements"
  }
]